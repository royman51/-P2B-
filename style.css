:root{
  --ui-w: calc(100% - 24px);
  /* Dark (default) theme: deeper, lower-contrast colors */
  --bg: #0b0f12; /* much darker background */
  --panel: #0f1316; /* dark panels */
  --panel-variant: rgba(255,255,255,0.02);
  --accent: #79BFE9; /* slightly more vivid bluish accent */
  --muted: #93A6B5; /* subdued muted text */
  --glow: rgba(30,180,255,0.10); /* a touch brighter/bluer glow */
  --btn-text: #FFFFFF;
  --gap: 10px;
}
/* Light theme overrides */
body.light{
  --bg: #DCEEFB; /* pastel blue background */
  --panel: #FFFFFF;
  --panel-variant: rgba(0,0,0,0.03);
  --accent: #0B3B69; /* deep blue for contrast on light */
  --muted: #4B6B82;
  --btn-text: #ffffff;
}

/* tooltip styles */
#toolTip{
  position:fixed;
  pointer-events:none;
  background: rgba(20,20,20,0.92);
  color:#fff;
  padding:8px 10px;
  border-radius:8px;
  font-size:13px;
  z-index:9999;
  transform:translate(12px,12px);
  max-width:320px;
  box-shadow: 0 8px 22px rgba(0,0,0,0.45);
}
#toolTip.hidden{ display:none; }
#toolTip::after{ content:""; position:absolute; width:8px; height:8px; transform:rotate(45deg); left:8px; top:-4px; background:rgba(20,20,20,0.92); }

body, #palette, #jsonOut, .color-swatch, button, input[type=number], input[type=text]{
  transition: background-color 180ms linear, color 180ms linear, border-color 180ms linear, box-shadow 180ms linear, transform 120ms linear;
}
html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,Segoe UI,Roboto,Arial;color:var(--accent)}
#c{position:fixed;inset:0;display:block;width:100%;height:100%}
/* UI moved to top center and made horizontal */
#ui{position:fixed;left:12px;right:12px;bottom:12px;z-index:12;touch-action:none;pointer-events:auto;display:flex;justify-content:center}
#palette{
  width:100%;
  /* refined dark-toned solid panel (no glass blur) */
  background: var(--panel);
  padding:12px;border-radius:10px;
  box-shadow: 0 8px 18px rgba(0,0,0,0.6);
  border: 1px solid rgba(255,255,255,0.03);
  max-height: none;
  overflow: visible;
  display:block;
  box-sizing: border-box;
  padding-left:40px;
  padding-right:16px;
}
/* Light theme variant keeps translucency but darkens border slightly */
body.light #palette{
  /* light theme uses a brighter surface with subtle border */
  background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,250,0.98));
  border: 1px solid rgba(0,0,0,0.06);
}

/* header */
#paletteHeader{display:flex;flex-direction:column;padding:6px 8px;margin-bottom:12px;border-radius:8px}
#paletteHeader .title{font-weight:800;font-size:16px;letter-spacing:0.2px}
#paletteHeader .sub{font-size:12px;color:var(--muted);margin-top:4px}

/* panels grid - horizontal layout */
#panels{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  grid-auto-rows: auto;
  grid-gap: var(--gap);
  align-items:start;
  justify-items: center; /* center items horizontally */
}
/* keep materials and json spanning full width within horizontal layout */
#materialsPanel{ grid-column: 1 / -1; } /* span full width */
#jsonPanel{ grid-column: 1 / -1; } /* span full width and be bottom */
/* New: tab bar to switch between panel groups (multiple screens) */
.panelTabs{
  display:flex;
  gap:8px;
  margin-bottom:10px;
  flex-wrap:wrap;
  justify-content:flex-start;
}
.tabBtn{
  padding:8px 10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.04);
  background:transparent;
  color:var(--accent);
  cursor:pointer;
  font-size:13px;
  box-shadow: none;
  transition: background-color 140ms linear, border-color 140ms linear, transform 80ms linear;
}
.tabBtn.active{
  background: linear-gradient(180deg, rgba(30,144,255,0.14), rgba(30,144,255,0.06));
  border-color: rgba(30,144,255,0.28);
  color:var(--btn-text);
  transform: none;
  box-shadow: 0 8px 22px rgba(30,144,255,0.12);
}
/* hide panels when not active */
.panel.hidden{ display:none !important; }

.panel{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
  box-shadow: 0 6px 14px rgba(0,0,0,0.35);
  min-height:48px;
  text-align: center; /* center text inside panels */
}
.panelTitle{font-size:13px;margin-bottom:8px;color:var(--muted);display:block}

/* materials list & icons */
.materialsList{ display:flex;flex-wrap:wrap;gap:8px;align-items:flex-start}
.mat-icon{ min-width:72px;padding:6px;background:transparent;border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;flex-direction:column;gap:6px;border:1px solid rgba(0,0,0,0.06);color:var(--accent) }
.mat-icon img{ width:56px;height:40px;object-fit:cover;border-radius:6px;display:block }
.mat-text{ display:none } /* keep text buttons hidden; we show icons */

.mat-icon:hover{
  box-shadow: none;
  background: rgba(255,255,255,0.02);
}

.smallBtn{
  padding:8px 10px;border-radius:10px;border:0;background:linear-gradient(180deg, rgba(20,90,160,0.95), rgba(15,65,130,0.95));color:var(--btn-text);cursor:pointer;min-height:40px;box-shadow: 0 8px 20px rgba(13,83,150,0.18);
}
.smallBtn.alt{ background:transparent;border:1px solid rgba(255,255,255,0.04); color:var(--accent) }

.row{display:flex;gap:8px;align-items:center}
input[type=number]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--accent);min-height:44px}
input[type=color]{width:44px;height:36px;padding:0;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#fff}
input[type=text]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--accent)}

#colors{display:flex;flex-wrap:wrap;gap:8px}
.color-swatch{width:44px;height:44px;border-radius:8px;border:2px solid rgba(0,0,0,0.25);cursor:pointer;box-shadow:0 6px 12px rgba(0,0,0,0.35)}
.color-swatch.selected{outline:2px solid rgba(255,255,255,0.12);transform:scale(1.03);box-shadow:0 10px 26px var(--glow)}
/* Flatten color swatches */
.color-swatch{
  box-shadow: none;
  border: 1px solid rgba(0,0,0,0.12);
}
.color-swatch.selected{
  outline:2px solid rgba(30,144,255,0.16);
  transform: none;
  box-shadow: 0 8px 24px var(--glow);
  background-image: linear-gradient(rgba(255,255,255,0.03), rgba(0,0,0,0.02));
}

#jsonOut{width:100%;height:120px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent);padding:8px;border-radius:8px;resize:none;font-family:monospace;font-size:12px;box-sizing:border-box}

/* small responsive for mobile */
@media (max-width:520px){
  :root{--ui-w:calc(100% - 24px)}
  /* stack panels vertically on narrow screens and make the bottom bar taller */
  #panels{ grid-template-columns: 1fr; grid-template-rows: none; }
  #materialsPanel,#jsonPanel{ grid-column: auto }
  #ui{left:8px;right:8px;bottom:8px}
  .color-swatch{width:40px;height:40px}
  .smallBtn{min-height:46px}
}
/* Top-left branding moved out of palette */
#brand{
  position:fixed;
  top:12px;
  left:12px;
  z-index:20;
  display:flex;
  align-items:center;
  gap:8px;
  pointer-events:auto;
}
#brand #musicToggle{
  /* keep markup for accessibility but let .toolIcon provide the primary visuals */
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px;
  border-radius:12px;
  background:transparent;
  border:0;
  cursor:pointer;
  color:var(--accent);
  text-align:left;
  -webkit-tap-highlight-color: rgba(0,0,0,0.06);
}
#brand #musicToggle img,
#brand #musicToggle #musicToggleIcon{
  width:36px;
  height:36px;
  object-fit:contain;
  display:block;
}
#brand #musicToggle .toolLabel,
#brand #musicToggle #musicToggleLabel{
  font-size:12px;
  color:var(--muted);
}

/* preserve muted opacity behavior when the button itself is muted */
#brand #musicToggle.muted img,
#brand #musicToggle.muted #musicToggleIcon{
  opacity:0.45;
}

/* Top toolbar for tools: switch to a two-row centered layout */
#topbar{
  position:fixed;
  top:12px;
  left:50%;
  transform:translateX(-50%);
  z-index:60;
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:center;
  pointer-events:auto;
  transition: opacity 0.6s ease, transform 0.6s ease, visibility 0.6s ease;
  opacity: 1;
  visibility: visible;
}

/* Hidden state before Play -> keep out of hit-test and visually offscreen */
#topbar.topbar-hidden{
  opacity: 0;
  transform: translateX(-50%) translateY(-10px);
  visibility: hidden;
  pointer-events: none;
}

/* each row holds a set of icons */
.topbar-row{
  display:flex;
  align-items:center;
  gap:8px;
  width:100%;
  justify-content:center;
}

/* left group inside first row (keeps main tool icons grouped) */
.topbar-left{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:center;
}

/* center group inside second row for settings / B2J / music */
.topbar-center{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
}

/* ensure toolbar right column aligns horizontally (prevents B2J stacking) */
#topbar-right-column{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
}

/* general tool icon styling so music toggle matches other buttons */
.toolIcon{
  width:64px;
  height:64px;
  padding:8px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,0.06);
  background:var(--panel);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:6px;
  cursor:pointer;
  box-shadow: 0 8px 20px rgba(0,0,0,0.18);
  color:var(--accent);
}
.toolIcon img{
  width:36px;
  height:36px;
  object-fit:contain;
  display:block;
}
.toolIcon .toolLabel{
  font-size:12px;
  color:var(--muted);
  margin-top:4px;
  line-height:1;
}

/* preserve existing music-specific muted rules but keep them compatible */
#musicToggle.muted img,
#musicToggle.muted #musicToggleIcon{
  opacity:0.45;
}

/* spacer to keep first row centered visually when rows differ */
.topbar-spacer{ flex:1; min-width:12px; }

/* ensure tooltip is readable on light theme */
body.light #toolTip{
  background: rgba(10,18,28,0.96);
}

/* ensure topbar is responsive and centered on small screens */
@media (max-width:900px){
  #topbar{ top:8px; left:50%; transform:translateX(-50%); gap:6px; }
  .toolIcon{ width:56px;height:56px;padding:8px;border-radius:50%; }
  .toolIcon img{ width:28px;height:28px; }
}

/* Long toggle button for second topbar row */
#topbar-row2-toggle-container{
  margin-top:6px;
  display:flex;
  justify-content:center;
  align-items:center;
  pointer-events:auto;
}
/* make the toggle visually longer and flat while keeping .toolIcon visuals */
.openToggle{
  width: 160px;
  height: 44px;
  border-radius: 10px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:6px 12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  border:1px solid rgba(255,255,255,0.03);
  font-size:18px;
  font-weight:600;
  color:var(--muted);
}
.openToggle #topbarRow2ToggleIcon{
  font-size:18px;
  line-height:1;
  transform: none;
  display:inline-block;
  pointer-events:none;
}

/* When open, slightly change background and caret color for affordance */
#topbar.row2-open .openToggle{
  background: linear-gradient(180deg, rgba(30,144,255,0.12), rgba(30,144,255,0.06));
  color:var(--btn-text);
  border-color: rgba(30,144,255,0.18);
}
#topbar.row2-open .openToggle #topbarRow2ToggleIcon{
  color:var(--btn-text);
}

/* Top-right destroy button container */
#topright{
  position:fixed;
  top:12px;
  right:12px;
  z-index:70;
  pointer-events:auto;
  display:flex;
  gap:6px;
}
#topright .toolIcon{
  width:56px;
  height:56px;
  padding:8px;
  border-radius:50%;
  border:1px solid rgba(0,0,0,0.06);
  background:var(--panel);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow: 0 8px 20px rgba(0,0,0,0.18);
}
#topright .toolIcon img{ width:28px;height:28px; object-fit:contain; display:block; }

/* Hide palette by default; it will be shown when a tool is active via JS */
#ui{ display:none; position:fixed; left:12px; right:12px; bottom:12px; z-index:12; touch-action:none; pointer-events:auto; justify-content:center}
/* when shown, apply previous styles */
#ui.visible{ display:flex; }

/* Mobile / Tablet improvements: larger targets, bottom sheet feel, single-row controls on very small screens */
@media (max-width:900px){
  /* make the UI bar sit flush to bottom and appear as a compact bottom sheet */
  #ui{
    left:8px;
    right:8px;
    bottom:8px;
    align-items:flex-end;
  }
  #palette{
    padding:10px;
    border-radius:12px;
    max-height:44vh;
    overflow:auto;
    -webkit-overflow-scrolling:touch;
  }
  /* bigger tabs & buttons for touch */
  .tabBtn{
    padding:12px 14px;
    font-size:15px;
    min-height:44px;
    border-radius:12px;
  }
  .smallBtn{
    padding:12px 14px;
    min-height:48px;
    border-radius:12px;
    font-size:15px;
  }
  input[type=number], input[type=text]{
    min-height:48px;
    padding:12px;
    font-size:15px;
  }
  .mat-icon{
    min-width:84px;
    padding:8px;
    gap:8px;
  }
  .mat-icon img{ width:64px; height:46px; }
  .color-swatch{ width:48px;height:48px;border-radius:10px; }
  #jsonOut{ height:120px; font-size:13px; }
  /* ensure floating menu is touch-friendly */
  #blockMenu{ touch-action:manipulation; -webkit-user-select:none; }
  /* hide top-left branding on very small screens to preserve space */
  #brand{ display:flex; top:8px; left:8px; }
  @media (max-width:420px){
    #brand{ display:none; }
  }
}

/* Improve hit-area for grow handles on touch by increasing visual sizes inside UI (no direct 3D changes here) */
.mat-icon, .color-swatch, .smallBtn, .tabBtn{
  touch-action: manipulation;
  -webkit-tap-highlight-color: rgba(0,0,0,0.05);
}

/* Ensure no vertical scrolling is required for main experience (UI limited to a portion of screen) */
html, body { overscroll-behavior-y: none; }

/* ------------------ Splash / Game Menu styles ------------------ */
#splash{
  position:fixed;
  inset:0;
  z-index:120;
  display:flex;
  align-items:center;
  justify-content:center;
  /* make splash fully transparent so underlying canvas shows through */
  /* translucent overlay that softly blurs the scene behind the menu */
  background: rgba(6,10,12,0.45);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  transition: opacity 0.6s ease, visibility 0.6s ease;
  opacity:1;
  visibility:visible;
  pointer-events:auto;
}
#splash.splash-hidden{
  opacity:0;
  visibility:hidden;
  pointer-events:none;
}

#splash .splash-inner{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:18px;
  padding:28px;
  border-radius:14px;
  /* slightly translucent card look */
  /* keep card shell visually minimal so logo/play images appear over transparent backgrounds */
  /* Remove any visual shell so images are placed directly with no background */
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  transform: translateY(0);
}

/* logo sizing */
#splashLogo{
  width: min(58vw, 420px);
  max-width: 420px;
  height: auto;
  display:block;
  -webkit-user-drag: none;
  /* force any image background to be transparent in layout */
  background: transparent !important;
  /* in case the image contains an embedded opaque background, ensure surrounding element shows none */
  image-rendering: auto;
}

/* play button styling (uses provided image, keep its own look but ensure touch targets are large) */
.splash-play{
  border:0;
  background:transparent;
  padding:0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  -webkit-tap-highlight-color: rgba(0,0,0,0.06);
  width:220px;
  height:62px;
  border-radius:12px;
  transition: transform 140ms ease, box-shadow 140ms ease, opacity 240ms ease;
  /* ensure the play button has no background shell or shadow so only the image shows */
  box-shadow: none !important;
  border: none !important;
}
.splash-play img{ width:100%; height:100%; object-fit:contain; display:block; pointer-events:none; 
  /* ensure play button image displays without any background behind it */
  background: transparent !important;
  /* remove any default image smoothing backgrounds */
  -webkit-background-clip: padding-box;
  background-clip: padding-box;
}
#splash .splash-inner img { background: transparent !important; border: none !important; box-shadow: none !important; }
/* pressed/tap feedback */
.splash-play:active{ transform: translateY(2px) scale(0.995); box-shadow: 0 8px 18px rgba(0,0,0,0.45); }

/* smaller screens adjustments */
@media (max-width:540px){
  #splash .splash-inner{ padding:18px; gap:12px; }
  .splash-play{ width:180px; height:56px; }
  #splashLogo{ width: min(78vw, 360px); }
}